<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Cadastro de Usuário Externo</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body class="container py-5">
  <h2 class="mb-4">Cadastro de Usuário Externo</h2>

  <div id="alertPlaceholder"></div>

  <form id="formUsuarioExterno">
    <div class="form-group">
      <label for="idExterno">ID</label>
      <input type="text" id="idExterno" class="form-control" placeholder="Ex: USR010" required>
    </div>
    <div class="form-group">
      <label for="nome">Nome Completo</label>
      <input type="text" id="nome" class="form-control" required>
    </div>
    <div class="form-group">
      <label for="empresa">Empresa</label>
      <input type="text" id="empresa" class="form-control" required>
    </div>
    <button type="submit" class="btn btn-primary">Cadastrar</button>
  </form>

<hr />
<h2>Usuários Externos Cadastrados</h2>
<table class="table table-striped" id="usuariosTable">
  <thead>
    <tr>
      <th>Nome</th>
      <th>Empresa</th>
      <th>Ações</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

  
  <script>
    const apiUrl = window.location.origin;

    const showAlert = (message, type = 'success') => {
      document.getElementById('alertPlaceholder').innerHTML = `
        <div class="alert alert-${type} alert-dismissible fade show mt-3" role="alert">
          ${message}
          <button type="button" class="close" data-dismiss="alert">&times;</button>
        </div>`;
    };

    document.getElementById('formUsuarioExterno').addEventListener('submit', async (e) => {
      e.preventDefault();

      const idExterno = document.getElementById('idExterno').value.trim();
      const nome = document.getElementById('nome').value.trim();
      const empresa = document.getElementById('empresa').value.trim();

      try {
        const res = await fetch(`${apiUrl}/usuarios-externos`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify([{ idExterno, nome, empresa }])
        });

        const msg = await res.text();

        if (res.ok) {
          showAlert('✅ Usuário externo cadastrado com sucesso!');
          e.target.reset();
        } else {
          showAlert('❌ Erro: ' + msg, 'danger');
        }
      } catch (err) {
        console.error(err);
        showAlert('❌ Erro na conexão com o servidor', 'danger');
      }
    });
  </script>
</body>
</html>
