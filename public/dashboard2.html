<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>RPDNIT – Dashboard2 (teste)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#0b0f13">

  <!-- Bootstrap 4.5 -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet" />

  <!-- Estilos do layout novo -->
  <link rel="stylesheet" href="styles.css?v=2">
  <link rel="stylesheet" href="dark.css?v=2">

  <style>
    /* ... (mantive o mesmo CSS que você já tem no dashboard2) ... */
  </style>
</head>
<body>
  <div class="layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="brand">
        <i class="fas fa-road"></i>
        <div class="title">RPDNIT</div>
      </div>
      <nav class="side-menu">
        <div class="side-group">
          <div class="side-label hide-at-md">Navegação</div>
          <a class="nav-btn active" href="/dashboard.html"><i class="fas fa-th-large"></i><span class="hide-at-md">Serviços</span></a>
          <a class="nav-btn" href="/admin.html"><i class="fas fa-tools"></i><span class="hide-at-md">Administração</span></a>
          <a class="nav-btn" href="/login.html"><i class="fas fa-sign-in-alt"></i><span class="hide-at-md">Login</span></a>
          <a class="nav-btn" href="/"><i class="fas fa-user-plus"></i><span class="hide-at-md">Cadastro</span></a>
        </div>
        <div class="side-group">
          <div class="side-label hide-at-md">Atalhos</div>
          <a class="nav-btn" href="#pdf">
            <i class="fas fa-file-pdf"></i><span class="hide-at-md">Ferramentas PDF</span>
          </a>
          <a class="nav-btn" href="#sei">
            <i class="fas fa-file"></i><span class="hide-at-md">Fluxos SEI</span>
          </a>
          <a class="nav-btn" href="#outros">
            <i class="fas fa-layer-group"></i><span class="hide-at-md">Outros</span>
          </a>
        </div>
      </nav>
    </aside>

    <!-- Main -->
    <main class="main">
      <!-- Topbar -->
      <div class="topbar">
        <div class="topbar-inner">
          <div class="search">
            <i class="fas fa-search"></i>
            <input id="searchInput" type="text" placeholder="Buscar serviço… (ex.: PDF, assinatura, acesso externo)">
          </div>
          <span class="pill" id="rolePill">…</span>
          <div class="user">
            <div class="avatar"><i class="fas fa-user"></i></div>
            <button class="btn btn-outline-light btn-sm" id="logoutButton"><i class="fas fa-sign-out-alt mr-1"></i> Sair</button>
          </div>
        </div>
      </div>

      <!-- Conteúdo -->
      <section class="content">
        <div class="page-title">
          <h2>Serviços Disponíveis</h2>
          <small class="text-muted" style="color:var(--muted) !important;">Selecione um serviço para iniciar uma solicitação</small>
        </div>

        <!-- Fluxos SEI -->
        <!-- (mantive exatamente os mesmos cards que você já tinha) -->
        <!-- ... -->
      </section>
    </main>
  </div>

  <!-- Modal do Formulário -->
  <div class="modal fade" id="fluxoModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content" style="background:var(--panel); color:var(--text); border:1px solid var(--border); border-radius:16px;">
        <div class="modal-header" style="border-color:var(--border)">
          <h5 class="modal-title" id="modalTitle"></h5>
          <button type="button" class="close" data-dismiss="modal" style="color:#fff; opacity:.7;">
            <span>&times;</span>
          </button>
        </div>
        <div class="modal-body"></div>
      </div>
    </div>
  </div>

  <!-- Overlay compatível com seu script antigo -->
  <div id="loadingOverlay"
       style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);
              z-index:9999;align-items:center;justify-content:center;">
    <div style="color:#fff;font-size:1.5rem;">
      <div class="spinner-border text-light" role="status" style="width:3rem;height:3rem;">
        <span class="sr-only">Carregando...</span>
      </div>
      <p class="mt-3 mb-0">Processando, por favor aguarde...</p>
    </div>
  </div>

  <!-- Alert/Toast container -->
  <div class="alert-container" id="alertPlaceholder"></div>

  <!-- WhatsApp -->
  <a href="https://wa.me/5561996686541" class="whatsapp-float" target="_blank" title="Fale conosco no WhatsApp">
    <i class="fab fa-whatsapp"></i>
  </a>

  <!-- Scripts -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <!-- Usa o script.js antigo -->
  <script src="script.js?v=2"></script>

  <!-- Ajustes específicos do dashboard2 -->
  <script>
    // Busca por texto nos cards
    (function initSearch(){
      var input = document.getElementById('searchInput');
      if(!input) return;
      input.addEventListener('input', function(){
        var q = this.value.toLowerCase();
        document.querySelectorAll('.service-card').forEach(function(card){
          var text = (card.innerText + ' ' + (card.getAttribute('data-keywords')||'')).toLowerCase();
          card.parentElement.parentElement.style.display = text.includes(q) ? '' : 'none';
        });
      });
    })();

    // Autenticação + restrição por role
    document.addEventListener('DOMContentLoaded', async () => {
      const token = localStorage.getItem('token');
      if (!token) { alert('Você não está autenticado. Redirecionando para o login…'); location.href='login.html'; return; }
      try {
        const res = await fetch(`${window.location.origin}/verify-token`, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ token })
        });
        const data = await res.json();
        if (!data.valid) { localStorage.removeItem('token'); return location.href = 'login.html'; }
        const userRole = data.userRole || data.role;
        document.getElementById('rolePill').textContent = `Perfil: ${userRole}`;
        document.querySelectorAll('.service-card').forEach((card) => {
          const roleAttr = card.getAttribute('data-role');
          if(!roleAttr) return;
          const allowed = roleAttr.split(',').map(r=>r.trim());
          if(!allowed.includes(userRole)){
            card.classList.add('restrito');
            card.removeAttribute('onclick');
            card.setAttribute('data-toggle', 'tooltip');
            card.setAttribute('title', 'Acesso restrito: serviço disponível apenas para níveis superiores');
          }
        });
        $('[data-toggle="tooltip"]').tooltip();
      } catch(e){
        console.error(e);
        alert('Erro ao verificar autenticação. Redirecionando para o login…');
        localStorage.removeItem('token');
        location.href='login.html';
      }
    });

    // Logout
    document.addEventListener('click', function(e){
      if(e.target.closest('#logoutButton')){
        localStorage.removeItem('token');
        location.href='login.html';
      }
    });
  </script>
</body>
</html>
